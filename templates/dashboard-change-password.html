{% extends "header_footer.html" %}

{% load static %}
    <!-- End Breadcrumb section -->
{% block title%}Change Password{%endblock%}
{% block extra_css %}
<style>
    /* This container holds the input and the icon */
    .form-inner {
        position: relative;
    }

    /* Add padding to the input to make space for the icon */
    .form-inner .form-control {
        padding-right: 45px;
    }

    /* This positions the icon inside the input field */
    .password-toggle-icon {
        position: absolute;
        top: 50%;
        right: 15px;
        transform: translateY(-50%);
        cursor: pointer;
        color: #6c757d;
    }
    
    /* Styling for the error messages to match your image */
    .error-message {
        color: #dc3545; /* Standard red for errors */
        font-size: 0.875em;
        display: block;
        margin-top: 0.5rem;
    }
</style>{%endblock%}
{%block content%}
    <!-- Start Breadcrumb section -->
    <div class="breadcrumb-section seven" style="background-image:url({% static 'assets/img/inner-pages/breadcrumb-bg7.png' %});">  
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="banner-content">
                        <h1>Profile</h1>
                        <ul class="breadcrumb-list">
                            <li><a href="{% url 'home' %}">Home</a></li>
                            <li>Profile</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Breadcrumb section -->
    <!-- Start Dashboard section -->
        {% include "dashboard-menu.html" %}
                <div class="dashboard-content-wrap two">
                    <div class="change-pass-wrap">
                        <div class="edit-info-area">
                            <h6>Update Your Password</h6>
                           <form class="edit-info-form" method="post" action="{% url 'change_password' %}" novalidate>
                {% csrf_token %}
                <div class="row">

                    <!-- Old Password Field -->
                    <div class="col-md-12 mb-4">
                        <label for="{{ form.old_password.id_for_label }}" class="form-label">{{ form.old_password.label }}</label>
                        <div class="form-inner">
                            {{ form.old_password }}
                            <i class="bi bi-eye-slash password-toggle-icon" id="toggleOldPassword"></i>
                        </div>
                        <!-- ERROR MESSAGE IS NOW OUTSIDE THE 'form-inner' DIV -->
                        {% if form.old_password.errors %}
                            <span class="error-message">* {{ form.old_password.errors.as_text|cut:"* " }}</span>
                        {% endif %}
                    </div>

                    <!-- New Password Field -->
                    <div class="col-md-12 mb-4">
                        <label for="{{ form.new_password1.id_for_label }}" class="form-label">{{ form.new_password1.label }}</label>
                        <div class="form-inner">
                            {{ form.new_password1 }}
                             <i class="bi bi-eye-slash password-toggle-icon" id="toggleNewPassword1"></i>
                        </div>
                        {% if form.new_password1.errors %}
                            <span class="error-message">* {{ form.new_password1.errors.as_text|cut:"* " }}</span>
                        {% endif %}
                    </div>

                    <!-- Confirm Password Field -->
                    <div class="col-md-12 mb-5">
                        <label for="{{ form.new_password2.id_for_label }}" class="form-label">{{ form.new_password2.label }}</label>
                        <div class="form-inner">
                            {{ form.new_password2 }}
                            <i class="bi bi-eye-slash password-toggle-icon" id="toggleNewPassword2"></i>
                        </div>
                        {% if form.new_password2.errors %}
                            <span class="error-message">* {{ form.new_password2.errors.as_text|cut:"* " }}</span>
                        {% endif %}
                    </div>

                </div>
                <button class="primary-btn btn btn-success" type="submit" style="padding: 12px 25px; font-size: 1rem;">
                    Change Password
                </button>
            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Dashboard section -->

    {%endblock%}
    
{% block js %}
{# Add this block to your base.html before the closing </body> tag #}
<script>
document.addEventListener('DOMContentLoaded', function () {
    
    function createPasswordToggle(toggleId, passwordId) {
        const toggleIcon = document.getElementById(toggleId);
        const passwordInput = document.getElementById(passwordId);

        if (toggleIcon && passwordInput) {
            toggleIcon.addEventListener('click', function () {
                // Toggle the type attribute
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);

                // Toggle the icon class
                this.classList.toggle('bi-eye-slash');
                this.classList.toggle('bi-eye');
            });
        }
    }

    // Initialize toggles for all password fields
    // Note: We need to get the actual IDs Django generates for the inputs.
    createPasswordToggle('toggleOldPassword', '{{ form.old_password.id_for_label }}');
    createPasswordToggle('toggleNewPassword1', '{{ form.new_password1.id_for_label }}');
    createPasswordToggle('toggleNewPassword2', '{{ form.new_password2.id_for_label }}');

});
</script>
{% endblock %}