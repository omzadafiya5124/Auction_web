{% load static %}
<form id="modalProductForm" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.non_field_errors }}

    <div class="form-grid">
        <div class="form-group full">
            <label>{{ form.product_name.label }}</label>
            {{ form.product_name }}
            {{ form.product_name.errors }}
        </div>
        <div class="form-group">
            <label>{{ form.start_price.label }}</label>
            {{ form.start_price }}
            {{ form.start_price.errors }}
        </div>
        <div class="form-group">
            <label>{{ form.category.label }}</label>
            {{ form.category }}
            {{ form.category.errors }}
        </div>
        <div class="form-group">
            <label>{{ form.seller.label }}</label>
            <input type="text" id="sellerSearch" class="form-control" placeholder="Search seller..." style="margin-bottom:8px;">
            {{ form.seller }}
            {{ form.seller.errors }}
        </div>
        <div class="form-group full">
            <label>{{ form.sub_description.label }}</label>
            {{ form.sub_description }}
            {{ form.sub_description.errors }}
        </div>
        <div class="form-group full">
            <label>{{ form.product_description.label }}</label>
            {{ form.product_description }}
            {{ form.product_description.errors }}
        </div>
        <div class="form-group">
            <label>{{ form.auction_start_date_time.label }}</label>
            {{ form.auction_start_date_time }}
            {{ form.auction_start_date_time.errors }}
        </div>
        <div class="form-group">
            <label>{{ form.auction_end_date_time.label }}</label>
            {{ form.auction_end_date_time }}
            {{ form.auction_end_date_time.errors }}
        </div>
        <div class="form-group full">
            <label>{{ form.main_image.label }}</label>
            <div class="image-preview">
                {{ form.main_image }}
                {% if form.instance and form.instance.pk and form.instance.main_image %}
                    <img src="{{ form.instance.main_image.url }}" alt="Current image">
                {% endif %}
            </div>
            {{ form.main_image.errors }}
        </div>

        <div class="form-group full">
            <label for="id_gallery_images_upload">Gallery Images</label>
            <div class="image-preview" style="flex-wrap: wrap; gap:10px;">
                {{ form.gallery_images_upload }}
                {% if form.instance and form.instance.pk and form.instance.gallery_images %}
                    {% for path in form.instance.gallery_images %}
                        <img src="/{{ path }}" alt="Gallery image">
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>

    <div style="margin-top: 16px; display: flex; gap: 8px; justify-content: flex-end;">
        <button type="button" class="btn btn-secondary" id="modalCancelBtn">Cancel</button>
        <button type="submit" class="btn btn-primary">Save</button>
    </div>
</form>

<script>
(function(){
  const input = document.getElementById('sellerSearch');
  const select = document.getElementById('{{ form.seller.id_for_label }}');
  if(input && select){
    const options = Array.from(select.options).map(o=>({value:o.value, text:o.text, selected:o.selected}));
    input.addEventListener('input', function(){
      const q = input.value.toLowerCase();
      select.innerHTML = '';
      options.forEach(function(opt){
        if(!q || opt.text.toLowerCase().includes(q)){
          const el = document.createElement('option');
          el.value = opt.value; el.text = opt.text; el.selected = opt.selected && (!q || opt.text.toLowerCase().includes(q));
          select.appendChild(el);
        }
      });
    });
  }
})();
</script>

